{% include "/admin/sidebar.html" %}
<head>
  <script src="{{ url_for('static', filename='js/admin/manageRestaurant.js') }}"></script>
  <style>
    /* hi·ªáu ·ª©ng hover v√† con tr·ªè tay */
    .rs-row.clickable { cursor: pointer; }
    .rs-row.clickable:hover { box-shadow: 0 8px 24px rgba(0,0,0,.3);}
    /* tr√°nh xung ƒë·ªôt khi b·∫•m n√∫t Action */
    .rs-action { pointer-events: auto; }
  </style>
</head>
<main class="page">
  <div class="container-fluid mt-4">
    <h2 class="mb-4">Danh s√°ch Nh√† h√†ng</h2>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin/listRestaurant.css') }}"/>

    <table class="rs-table table table-hover align-middle">
      <thead class="rs-thead">
        <tr class="rs-row-head">
          <th class="rs-col-id">ID</th>
          <th class="rs-col-name">T√™n nh√† h√†ng</th>
          <th class="rs-col-addr">ƒê·ªãa ch·ªâ</th>
          <th class="rs-col-status">Tr·∫°ng th√°i</th>
          <th class="rs-col-rating">ƒê√°nh gi√°</th>
          <th class="rs-col-action">Action</th>
        </tr>
      </thead>

      <tbody class="rs-body">
        {% for r in restaurants %}
        <!-- g·∫Øn data-href ƒë·ªÉ click/enter chuy·ªÉn trang -->
        <tr class="rs-row clickable"
            data-id="{{ r.restaurant_id }}"
            data-href="{{ url_for('admin.restaurant_detail', restaurant_id=r.restaurant_id) }}"
            role="button" tabindex="0" aria-label="Xem chi ti·∫øt nh√† h√†ng {{ r.name }}">
          <td class="rs-col rs-col--id"><div class="rs-id">#{{ r.restaurant_id }}</div></td>
          <td class="rs-col rs-col--name">
            <div class="rs-card">
              <div class="rs-info">
                <div class="rs-title">{{ r.name }}</div>
                {% if r.owner and r.owner.user %}
                <div class="rs-sub">Owner: {{ r.owner.user.email }}</div>
                {% endif %}
              </div>
            </div>
          </td>
          <td class="rs-col rs-col--addr">{{ r.address or "‚Äî" }}</td>
          <td class="rs-col rs-col--status">
            {% if r.status %}
              <span class="rs-badge rs-badge--{{ 'ok' if r.status.value=='APPROVED'
                                               else 'warn' if r.status.value=='PENDING'
                                               else 'err' }}">{{ r.status.value }}</span>
            {% endif %}
          </td>
          <td class="rs-col rs-col--rating">{{ "{:.1f}".format(r.rating_point) if r.rating_point else "Kh√¥ng" }}üåü</td>
          <td class="rs-col rs-col--action">
            <button class="rs-action rs-action--approve" title="Approve" data-id="{{ r.restaurant_id }}">
              <svg viewBox="0 0 24 24" class="ic"><path d="M20 6L9 17l-5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="rs-action rs-action--reject" title="Reject" data-id="{{ r.restaurant_id }}">
              <svg viewBox="0 0 24 24" class="ic"><path d="M18 6L6 18M6 6l12 12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </button>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="6" class="text-center text-muted py-4">Kh√¥ng c√≥ nh√† h√†ng n√†o.</td></tr>
        {% endfor %}
      </tbody>
    </table>

    {% if noti_assets is defined %}
      {{ noti_assets() }}
    {% else %}
      <div id="toast-stack"></div>
      <script src="{{ url_for('static', filename='js/toast.js') }}"></script>
    {% endif %}
  </div>
</main>

<script>
  // ƒêi·ªÅu h∆∞·ªõng khi click v√†o h√†ng (tr·ª´ khi click n√∫t Action)
  document.addEventListener('click', function(e){
    const row = e.target.closest('.rs-row.clickable');
    const isAction = !!e.target.closest('.rs-action');
    if (!row || isAction) return;
    const href = row.getAttribute('data-href');
    if (href) window.location.href = href;
  });

  // ƒêi·ªÅu h∆∞·ªõng khi nh·∫•n Enter tr√™n h√†ng ƒëang focus
  document.addEventListener('keydown', function(e){
    if (e.key !== 'Enter') return;
    const row = document.activeElement && document.activeElement.classList.contains('rs-row')
                ? document.activeElement
                : (document.activeElement ? document.activeElement.closest('.rs-row.clickable') : null);
    if (!row) return;
    const href = row.getAttribute('data-href');
    if (href) window.location.href = href;
  });
</script>

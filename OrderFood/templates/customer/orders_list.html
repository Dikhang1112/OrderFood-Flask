<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Đơn của tôi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
  <div class="container py-4">
    <div class="d-flex align-items-center mb-3">
      <a class="btn btn-outline-secondary me-2" href="{{ url_for('index') }}">← Trang chủ</a>
      <h4 class="m-0">Đơn hàng của tôi</h4>
    </div>

    <form class="row g-2 mb-3" method="get">
      <div class="col-auto">
        <select class="form-select" name="status" onchange="this.form.submit()">
          <option value="">Tất cả trạng thái</option>
          {% for s,label in [
            ('PENDING','Chờ thanh toán'),
            ('PAID','Đã thanh toán'),
            ('ACCEPTED','Đã xác nhận'),
            ('CANCELED','Đã hủy'),
            ('COMPLETED','Hoàn tất')
          ] %}
            <option value="{{ s }}" {{ 'selected' if status_filter==s else '' }}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
    </form>

    {% if orders|length == 0 %}
      <div class="alert alert-info">Bạn chưa có đơn hàng nào.</div>
    {% else %}
      <div class="card shadow-sm">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th style="width:100px;">Mã đơn</th>
                <th>Nhà hàng</th>
                <th style="width:160px;">Tổng tiền</th>
                <th style="width:160px;">Thời gian</th>
                <th style="width:140px;">Trạng thái</th>
                <th style="width:130px;"></th>
              </tr>
            </thead>
            <tbody>
            {% for od in orders %}
              {% set s = (od.status.value if od.status is not string else od.status)|upper %}
              {% set badge = (
                  'secondary' if s=='PENDING' else
                  'primary'   if s=='PAID' else
                  'info'      if s in ['ACCEPT','ACCEPTED'] else
                  'danger'    if s=='CANCELED' else
                  'success'   if s=='COMPLETED' else 'secondary'
              ) %}
              <tr>
                <td>#{{ od.order_id }}</td>
                <td>
                  {{ od.restaurant.name if od.restaurant else '—' }}
                </td>
                <td>{{ "{:,.0f}".format(od.total_price or 0) }} đ</td>
                <td>{{ od.created_date }}</td>
                <td><span class="badge bg-{{ badge }}">
                  {% if s=='PENDING' %}Chờ thanh toán
                  {% elif s=='PAID' %}Đã thanh toán
                  {% elif s in ['ACCEPT','ACCEPTED'] %}Đã xác nhận
                  {% elif s=='CANCELED' %}Đã hủy
                  {% elif s=='COMPLETED' %}Hoàn tất
                  {% else %}{{ s }}{% endif %}
                </span></td>
                <td class="text-end">
                  <a class="btn btn-sm btn-outline-primary"
                     href="{{ url_for('customer.order_track', order_id=od.order_id) }}">
                    Theo dõi
                  </a>
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- pagination -->
      <nav class="mt-3">
        <ul class="pagination justify-content-end">
          <li class="page-item {{ 'disabled' if page<=1 }}">
            <a class="page-link" href="{{ url_for('customer.my_orders', page=page-1, status=status_filter) }}">«</a>
          </li>
          {% for p in range(1, total_pages+1) %}
            <li class="page-item {{ 'active' if p==page }}">
              <a class="page-link" href="{{ url_for('customer.my_orders', page=p, status=status_filter) }}">{{ p }}</a>
            </li>
          {% endfor %}
          <li class="page-item {{ 'disabled' if page>=total_pages }}">
            <a class="page-link" href="{{ url_for('customer.my_orders', page=page+1, status=status_filter) }}">»</a>
          </li>
        </ul>
      </nav>
    {% endif %}
  </div>
</body>
</html>
